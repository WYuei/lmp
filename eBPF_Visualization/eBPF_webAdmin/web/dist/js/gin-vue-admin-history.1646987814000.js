/*! 
 Build based on gin-vue-admin 
 Time : 1646987814000 */
import{S as e,A as a,r as s,g as l,w as t,R as n,k as u,o,i as r,j as i,u as v,L as m,M as c,I as p,s as d,N as y,x as g,B as f,D as h,W as S,V as b,X as I}from"./gin-vue-admin-vendor.1646987814000.js";import{u as q,e as N}from"../gva/gin-vue-admin-index.1646987814000.js";const x={class:"router-history"},O={name:"HistoryComponent"},k=Object.assign(O,{setup(O){const k=e(),C=a(),J=e=>e.name+JSON.stringify(e.query)+JSON.stringify(e.params),w=s([]),V=s(""),E=s(!1),j=q(),L=e=>e.name+JSON.stringify(e.query)+JSON.stringify(e.params),P=s(0),T=s(0),A=s(!1),R=s(!1),X=s(""),_=l((()=>j.userInfo.authority.defaultRouter)),B=()=>{w.value=[{name:_.value,meta:{title:"首页"},query:{},params:{}}],C.push({name:_.value}),E.value=!1,sessionStorage.setItem("historys",JSON.stringify(w.value))},D=()=>{let e;const a=w.value.findIndex((a=>(J(a)===X.value&&(e=a),J(a)===X.value))),s=w.value.findIndex((e=>J(e)===V.value));w.value.splice(0,a),a>s&&C.push(e),sessionStorage.setItem("historys",JSON.stringify(w.value))},H=()=>{let e;const a=w.value.findIndex((a=>(J(a)===X.value&&(e=a),J(a)===X.value))),s=w.value.findIndex((e=>J(e)===V.value));w.value.splice(a+1,w.value.length),a<s&&C.push(e),sessionStorage.setItem("historys",JSON.stringify(w.value))},M=()=>{let e;w.value=w.value.filter((a=>(J(a)===X.value&&(e=a),J(a)===X.value))),C.push(e),sessionStorage.setItem("historys",JSON.stringify(w.value))},U=e=>{if(!w.value.some((a=>((e,a)=>{if(e.name!==a.name)return!1;for(const s in e.query)if(e.query[s]!==a.query[s])return!1;for(const s in e.params)if(e.params[s]!==a.params[s])return!1;return!0})(a,e)))){const a={};a.name=e.name,a.meta=e.meta,a.query=e.query,a.params=e.params,w.value.push(a)}window.sessionStorage.setItem("activeValue",J(e))},W=e=>{const a=e.instance.attrs.tab;C.push({name:a.name,query:a.query,params:a.params})},Y=e=>{const a=w.value.findIndex((a=>J(a)===e));J(k)===e&&(1===w.value.length?C.push({name:_.value}):a<w.value.length-1?C.push({name:w.value[a+1].name,query:w.value[a+1].query,params:w.value[a+1].params}):C.push({name:w.value[a-1].name,query:w.value[a-1].query,params:w.value[a-1].params})),w.value.splice(a,1)};t(E,(()=>{E.value?document.body.addEventListener("click",(()=>{E.value=!1})):document.body.removeEventListener("click",(()=>{E.value=!1}))})),t(k,((e,a)=>{"Login"!==e.name&&(w.value=w.value.filter((e=>!e.meta.closeTab)),U(e),sessionStorage.setItem("historys",JSON.stringify(w.value)),V.value=window.sessionStorage.getItem("activeValue"),a&&e&&a.name===e.name&&N.emit("reload"))}));return(()=>{N.on("closeThisPage",(()=>{Y(L(k))})),N.on("closeAllPage",(()=>{B()})),N.on("mobile",(e=>{R.value=e})),N.on("collapse",(e=>{A.value=e}));const e=[{name:_.value,meta:{title:"首页"},query:{},params:{}}];w.value=JSON.parse(sessionStorage.getItem("historys"))||e,window.sessionStorage.getItem("activeValue")?V.value=window.sessionStorage.getItem("activeValue"):V.value=J(k),U(k)})(),n((()=>{N.off("collapse"),N.off("mobile")})),(e,a)=>{const s=u("el-tab-pane"),l=u("el-tabs");return o(),r("div",x,[i(l,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=e=>V.value=e),closable:!(1===w.value.length&&e.$route.name===g(_)),type:"card",onContextmenu:a[1]||(a[1]=S((e=>(e=>{if(1===w.value.length&&k.name===_.value)return!1;let a="";if(a="SPAN"===e.srcElement.nodeName?e.srcElement.offsetParent.id:e.srcElement.id,a){let s;E.value=!0,s=A.value?54:220,R.value&&(s=0),P.value=e.clientX-s,T.value=e.clientY+10,X.value=a.split("-")[1]}})(e)),["prevent"])),onTabClick:W,onTabRemove:Y},{default:v((()=>[(o(!0),r(m,null,c(w.value,(e=>(o(),p(s,{key:L(e),label:e.meta.title,name:L(e),tab:e,class:"gva-tab"},{label:v((()=>[d("span",{style:y({color:V.value===L(e)?g(j).activeColor:"#333"})},[d("i",{class:"dot",style:y({backgroundColor:V.value===L(e)?g(j).activeColor:"#ddd"})},null,4),f(" "+h(e.meta.title),1)],4)])),_:2},1032,["label","name","tab"])))),128))])),_:1},8,["modelValue","closable"]),b(d("ul",{style:y({left:P.value+"px",top:T.value+"px"}),class:"contextmenu"},[d("li",{onClick:B},"关闭所有"),d("li",{onClick:D},"关闭左侧"),d("li",{onClick:H},"关闭右侧"),d("li",{onClick:M},"关闭其他")],4),[[I,E.value]])])}}});export{k as default};
