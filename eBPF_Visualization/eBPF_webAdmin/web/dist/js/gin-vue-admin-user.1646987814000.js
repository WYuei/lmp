/*! 
 Build based on gin-vue-admin 
 Time : 1646987814000 */
var e=(e,a,l)=>new Promise(((i,t)=>{var o=e=>{try{s(l.next(e))}catch(a){t(a)}},u=e=>{try{s(l.throw(e))}catch(a){t(a)}},s=e=>e.done?i(e.value):Promise.resolve(e.value).then(o,u);s((l=l.apply(e,a)).next())}));import{o as a,r as l,p as i,q as t,t as o,v as u}from"../gva/gin-vue-admin-index.1646987814000.js";import{g as s}from"./gin-vue-admin-authority.16469878140002.js";import{C as r}from"./gin-vue-admin-index.16469878140009.js";import{_ as n}from"./gin-vue-admin-index.164698781400013.js";import{w as d}from"./gin-vue-admin-warningBar.1646987814000.js";import{r as m,w as c,k as p,o as v,i as g,j as h,s as y,u as f,B as b,D as k,v as w,e as I,d as _,Q as V}from"./gin-vue-admin-vendor.1646987814000.js";const C={class:"gva-table-box"},N={class:"gva-btn-list"},x=b("新增用户"),z={key:0,class:"nickName"},U={key:1,class:"nickName"},j=y("p",null,"确定要删除此用户吗",-1),D={style:{"text-align":"right","margin-top":"8px"}},F=b("取消"),S=b("确定"),q=b("删除"),B=b("重置密码"),P={class:"gva-pagination"},T=["src"],E={key:1,class:"header-img-box"},R={class:"dialog-footer"},O=b("取 消"),Q=b("确 定"),A={name:"User"},G=Object.assign(A,{setup(A){const G=m("/api"),H=(e,a)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,children:[]};H(e.children,l.children),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName};a.push(l)}}))},J=m(1),K=m(0),L=m(10),M=m([]),W=e=>{L.value=e,Y()},X=e=>{J.value=e,Y()},Y=()=>e(this,null,(function*(){const e=yield a({page:J.value,pageSize:L.value});0===e.code&&(M.value=e.data.list,K.value=e.data.total,J.value=e.data.page,L.value=e.data.pageSize)}));c(M,(()=>{$()}));(()=>{e(this,null,(function*(){Y();const e=yield s({page:1,pageSize:999});ie(e.data.list)}))})();const Z=a=>{I.confirm("是否将此用户密码重置为123456?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>e(this,null,(function*(){const e=yield l({ID:a.ID});0===e.code?_({type:"success",message:e.msg}):_({type:"error",message:e.msg})}))))},$=()=>{M.value&&M.value.forEach((e=>{const a=e.authorities&&e.authorities.map((e=>e.authorityId));e.authorityIds=a}))},ee=m(null),ae=()=>{ee.value.open()},le=m([]),ie=e=>{le.value=[],H(e,le.value)},te=m(""),oe=a=>e(this,null,(function*(){0===(yield i({nickName:a.nickName,ID:a.ID})).code&&_({type:"success",message:"设置成功"}),te.value=m(""),a.editFlag=!1})),ue=a=>e(this,null,(function*(){0===(yield t({id:a.ID})).code&&(_.success("删除成功"),yield Y(),a.visible=!1)})),se=m({username:"",password:"",nickName:"",headerImg:"",authorityId:"",authorityIds:[]}),re=m({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:5,message:"最低5位字符",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:6,message:"最低6位字符",trigger:"blur"}],nickName:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],authorityId:[{required:!0,message:"请选择用户角色",trigger:"blur"}]}),ne=m(null),de=()=>e(this,null,(function*(){se.value.authorityId=se.value.authorityIds[0],ne.value.validate((a=>e(this,null,(function*(){if(a){0===(yield o(se.value)).code&&_({type:"success",message:"创建成功"}),yield Y(),ce()}}))))})),me=m(!1),ce=()=>{ne.value.resetFields(),se.value.headerImg="",se.value.authorityIds=[],me.value=!1},pe=()=>{me.value=!0},ve=(a,l)=>e(this,null,(function*(){if(l)return;yield V();0===(yield u({ID:a.ID,authorityIds:a.authorityIds})).code&&_({type:"success",message:"角色设置成功"})}));return(e,a)=>{const l=p("el-button"),i=p("el-table-column"),t=p("edit"),o=p("el-icon"),u=p("el-input"),s=p("check"),m=p("close"),c=p("el-cascader"),I=p("el-popover"),V=p("el-table"),A=p("el-pagination"),H=p("el-form-item"),Y=p("el-form"),$=p("el-dialog");return v(),g("div",null,[h(d,{title:"注：右上角头像下拉可切换角色"}),y("div",C,[y("div",N,[h(l,{size:"mini",type:"primary",icon:"plus",onClick:pe},{default:f((()=>[x])),_:1})]),h(V,{data:M.value},{default:f((()=>[h(i,{align:"left",label:"头像","min-width":"50"},{default:f((e=>[h(r,{style:{"margin-top":"8px"},"pic-src":e.row.headerImg},null,8,["pic-src"])])),_:1}),h(i,{align:"left",label:"UUID","min-width":"250",prop:"uuid"}),h(i,{align:"left",label:"用户名","min-width":"150",prop:"userName"}),h(i,{align:"left",label:"昵称","min-width":"100",prop:"nickName"},{default:f((e=>[e.row.editFlag?w("",!0):(v(),g("p",z,[b(k(e.row.nickName)+" ",1),h(o,{class:"pointer",color:"#66b1ff",onClick:a=>{return l=e.row,void(M.value.some((e=>e.editFlag))?_("当前存在正在编辑的用户"):(te.value=l.nickName,l.editFlag=!0));var l}},{default:f((()=>[h(t)])),_:2},1032,["onClick"])])),e.row.editFlag?(v(),g("p",U,[h(u,{modelValue:e.row.nickName,"onUpdate:modelValue":a=>e.row.nickName=a},null,8,["modelValue","onUpdate:modelValue"]),h(o,{class:"pointer",color:"#67c23a",onClick:a=>oe(e.row)},{default:f((()=>[h(s)])),_:2},1032,["onClick"]),h(o,{class:"pointer",color:"#f23c3c",onClick:a=>{return(l=e.row).nickName=te.value,te.value="",void(l.editFlag=!1);var l}},{default:f((()=>[h(m)])),_:2},1032,["onClick"])])):w("",!0)])),_:1}),h(i,{align:"left",label:"用户角色","min-width":"150"},{default:f((e=>[h(c,{modelValue:e.row.authorityIds,"onUpdate:modelValue":a=>e.row.authorityIds=a,options:le.value,"show-all-levels":!1,"collapse-tags":"",props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1,onVisibleChange:a=>{ve(e.row,a)},onRemoveTag:()=>{ve(e.row,!1)}},null,8,["modelValue","onUpdate:modelValue","options","onVisibleChange","onRemoveTag"])])),_:1}),h(i,{align:"left",label:"操作","min-width":"150"},{default:f((e=>[h(I,{visible:e.row.visible,"onUpdate:visible":a=>e.row.visible=a,placement:"top",width:"160"},{reference:f((()=>[h(l,{type:"text",icon:"delete",size:"mini"},{default:f((()=>[q])),_:1})])),default:f((()=>[j,y("div",D,[h(l,{size:"mini",type:"text",onClick:a=>e.row.visible=!1},{default:f((()=>[F])),_:2},1032,["onClick"]),h(l,{type:"primary",size:"mini",onClick:a=>ue(e.row)},{default:f((()=>[S])),_:2},1032,["onClick"])])])),_:2},1032,["visible","onUpdate:visible"]),h(l,{type:"text",icon:"magic-stick",size:"mini",onClick:a=>Z(e.row)},{default:f((()=>[B])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),y("div",P,[h(A,{"current-page":J.value,"page-size":L.value,"page-sizes":[10,30,50,100],total:K.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:X,onSizeChange:W},null,8,["current-page","page-size","total"])])]),h($,{modelValue:me.value,"onUpdate:modelValue":a[4]||(a[4]=e=>me.value=e),"custom-class":"user-dialog",title:"新增用户"},{footer:f((()=>[y("div",R,[h(l,{size:"small",onClick:ce},{default:f((()=>[O])),_:1}),h(l,{size:"small",type:"primary",onClick:de},{default:f((()=>[Q])),_:1})])])),default:f((()=>[h(Y,{ref_key:"userForm",ref:ne,rules:re.value,model:se.value,"label-width":"80px"},{default:f((()=>[h(H,{label:"用户名",prop:"username"},{default:f((()=>[h(u,{modelValue:se.value.username,"onUpdate:modelValue":a[0]||(a[0]=e=>se.value.username=e)},null,8,["modelValue"])])),_:1}),h(H,{label:"密码",prop:"password"},{default:f((()=>[h(u,{modelValue:se.value.password,"onUpdate:modelValue":a[1]||(a[1]=e=>se.value.password=e)},null,8,["modelValue"])])),_:1}),h(H,{label:"别名",prop:"nickName"},{default:f((()=>[h(u,{modelValue:se.value.nickName,"onUpdate:modelValue":a[2]||(a[2]=e=>se.value.nickName=e)},null,8,["modelValue"])])),_:1}),h(H,{label:"用户角色",prop:"authorityId"},{default:f((()=>[h(c,{modelValue:se.value.authorityIds,"onUpdate:modelValue":a[3]||(a[3]=e=>se.value.authorityIds=e),style:{width:"100%"},options:le.value,"show-all-levels":!1,props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1},null,8,["modelValue","options"])])),_:1}),h(H,{label:"头像","label-width":"80px"},{default:f((()=>[y("div",{style:{display:"inline-block"},onClick:ae},[se.value.headerImg?(v(),g("img",{key:0,class:"header-img-box",src:se.value.headerImg&&"http"!==se.value.headerImg.slice(0,4)?G.value+se.value.headerImg:se.value.headerImg},null,8,T)):(v(),g("div",E,"从媒体库选择"))])])),_:1})])),_:1},8,["rules","model"])])),_:1},8,["modelValue"]),h(n,{ref_key:"chooseImg",ref:ee,target:se.value,"target-key":"headerImg"},null,8,["target"])])}}});export{G as default};
